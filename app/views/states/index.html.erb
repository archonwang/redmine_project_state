<% content_for :header_tags do %>
<%= stylesheet_link_tag 'project_state.css', :plugin => 'project_state', :media => 'all' %>

<% end %>

<h3><%= l(:project_state_title) %></h3>

<table id="ps_summary">
  <thead>
    <tr>
      <th></th>
      <% @states.each do |s| %>
        <th><%= s %></th>
      <% end %>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <% @users.keys.each do |u| %>
      <tr>
        <% if @stark %>
          <td class="user_counts"><a href="<%= state_path(u) %>?report=stark"><%= href=@users[u].firstname %></a></td>
        <% else %>
          <td class="user_counts"><a href="<%= state_path(u) %>"><%= href=@users[u].firstname %></a></td>
        <% end %>
        <% @states.each do |s| %>
          <% if @flags[u][s] > 0 %>
            <td class="counts"><%= @issues[u][s] %> (<span class="flagged"><%= @flags[u][s] %></span>)</td>
          <% else %>
            <td class="counts"><%= @issues[u][s] %> (<span><%= @flags[u][s] %></span>)</td>
          <% end %>
        <% end %>
        <% if @rowflagsum[u] > 0 %>
          <td class="rowsum"><%= @rowsum[u] %> (<span class="flagged"><%= @rowflagsum[u] %></span>)</td>
        <% else %>
          <td class="rowsum"><%= @rowsum[u] %> (<span><%= @rowflagsum[u] %></span>)</td>
        <% end %>
      </tr>
    <% end %>
    <tr>
      <% if @stark %>
        <td class="user_counts"><a href="<%= state_path(-1) %>?report=stark">Unassigned</a></td>
      <% else %>
        <td class="user_counts"><a href="<%= state_path(-1) %>">Unassigned</a></td>
      <% end %>
      <% @states.each do |s| %>
        <% if @flags[-1][s] > 0 %>
          <td class="counts"><%= @issues[-1][s] %> (<span class="flagged"><%= @flags[-1][s] %></span>)</td>
        <% else %>
          <td class="counts"><%= @issues[-1][s] %> (<span><%= @flags[-1][s] %></span>)</td>
        <% end %>
      <% end %>
      <% if @rowflagsum[-1] > 0 %>
        <td class="rowsum"><%= @rowsum[-1] %> (<span class="flagged"><%= @rowflagsum[-1] %></span>)</td>
      <% else %>
        <td class="rowsum"><%= @rowsum[-1] %> (<span><%= @rowflagsum[-1] %></span>)</td>
      <% end %>
    </tr>
    <tr><td class="colsum"></td>
    <% @states.each do |s| %>
      <% if @colflagsum[s] > 0 %>
        <td class="colsum"><%= @colsum[s] %> (<span class="flagged"><%= @colflagsum[s] %></span>)</td>
      <% else %>
        <td class="colsum"><%= @colsum[s] %> (<span><%= @colflagsum[s] %></span>)</td>
      <% end %>
    <% end %>
    <% if @totalflagsum > 0 %>
      <td class="cornersum"><%= @totalsum %> (<span class="flagged"><%= @totalflagsum %></span>)</td>
    <% else %>
      <td class="cornersum"><%= @totalsum %> (<span><%= @totalflagsum %></span>)</td>
    <% end %>
  </tbody>
</table>
<p>
<% if @stark==true %>
  <a href="/states">The Regular Report</a>
<% else %>
  <a href="/states?report=stark">The Stark Report</a>
<% end %>
</p>
